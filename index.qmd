---
title: "Buffalo Creek Flood Risk Assessment"
author: Sazzad Hossain
subtitle: Find weather any Infrastructure at Risk of Flooding
date: 2025-11-20
date-format: long
code-fold: true
code-tools:
  toggle: true
---

# Introduction

This flood risk assessment analyzes Buffalo Creek in Erie County, New York, focusing on a 500m buffer zone around streams. \# Materials and methods

The analysis uses elevation data, stream extraction, and OpenStreetMap building footprints to assess flood risk. The goal is to identify buildings within the flood-prone area, providing insights for urban planning and disaster preparedness.

Here's my first code chunk.

## Load and setip

```{r echo= False, message=FALSE, warning=FALSE}


library(sf)
library(terra)
library(elevatr)
library(dataRetrieval)
library(osmdata)
library(ggplot2)
library(dplyr)
library(leaflet)
library(htmlwidgets)
library(knitr)
```

```{r message=FALSE}
dir.create("buffalo_creek_project")
setwd("buffalo_creek_project")
dir.create("data/raw", recursive = TRUE)
dir.create("data/processed")
dir.create("outputs")
```

## Define study area

```{r message=FALSE}
bbox_coords <- c(xmin = -78.85, ymin = 42.80, xmax = -78.65, ymax = 42.92)
study_bbox <- st_bbox(bbox_coords, crs = 4326)
study_area <- st_as_sfc(study_bbox)
study_area<- st_sf(geometry = study_area)
# Create USGS station point
station_point <- st_sf(name = "USGS 04214500",
                       geometry = st_sfc(st_point(c(-78.7564, 42.8546)),
                                         crs = 4326))

```

##Download DEM
```{r message=FALSE}
dem_raw <- get_elev_raster(locations = study_area, z = 13, src = "aws")
dem <- rast(dem_raw)
# visualize DEM
plot(dem, main = "Buffalo Creek DEM")
```

##Download streamflow data
```{r message=FALSE}
station_id <- "04214500"
flow_data <- readNWISdv(siteNumbers = station_id,
                        parameterCd = "00060",
                        startDate = "2014-01-01",
                        endDate = "2024-10-24")

flow_data <- renameNWISColumns(flow_data)
# Plot streamflow
ggplot(flow_data, aes(x = Date, y = Flow)) +
  geom_line(color = "blue") +
  labs(title = "Buffalo Creek Streamflow (2014-2024)",
       x = "Date", y = "Discharge (cfs)") +
  theme_minimal()
```

# stream extraction using flow accumulation
```{r}
dem_filled <- focal(dem, w = 3, fun = "median", na.policy = "only", na.rm = TRUE)
dem_filled[is.na(dem_filled)] <- -9999
dem_gradient <- focal(dem_filled, w = 5, fun = function(x) sd(x, na.rm = TRUE))
# Define streams as areas with high gradient variability
streams_rast <- dem_gradient > quantile(dem_gradient[], 0.75, na.rm = TRUE)

# Define streams as areas with high gradient variability
streams_rast <- dem_gradient > quantile(dem_gradient[], 0.75, na.rm = TRUE)

```

# Convert streams to vector
```{r}
streams_sf <- as.polygons(streams_rast > 0) |>
  st_as_sf() |>
  st_cast("MULTIPOLYGON") |>
  st_cast("MULTILINESTRING") |>
  st_cast("LINESTRING")

st_write(streams_sf, "data/processed/streams.shp", append = FALSE)
# Visualize extracted streams
plot(dem, main = "DEM with Extracted Streams")
plot(streams_sf, add = TRUE, col = "blue", lwd = 2)
```
# Create flood buffers around streams

# 500m buffer zone (secondary flood risk)
```{r}
flood_500m <- st_buffer(streams_sf, dist = 500)
flood_500m$zone <- "500m"
st_write(flood_500m, "data/processed/flood_zone_500m.shp", append = FALSE)

flood_500m <- st_read("data/processed/flood_zone_500m.shp", quiet = TRUE)

# Visualize
tmap_mode("plot")
static_map <- tm_shape(dem) +
  tm_raster(col_alpha = 0.7) +  # Elevation raster
  tm_shape(flood_500m) +
  tm_fill(col = "orange", fill_alpha = 0.3, fill.legend = tm_legend(title = "500m Flood Zone")) +  # Flood buffer
  tm_borders(col = "red", lwd = 2) +
  tm_shape(streams_sf) +
  tm_lines(col = "blue", lwd = 2) +  # Streams, no title param in v4
  tm_title("Buffalo Creek Flood Risk Zones") +
  tm_layout(legend.outside = TRUE) +
  tm_compass(position = c("left", "top")) +
  tm_scalebar(position = c("left", "bottom"))
```
