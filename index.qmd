---
title: "Buffalo Creek Flood Risk Assessment"
author: Sazzad Hossain
subtitle: Find weather any Infrastructure at Risk of Flooding
date: 2025-11-20
date-format: long
code-fold: true
code-tools:
  toggle: true
---

# Introduction

This flood risk assessment analyzes Buffalo Creek in Erie County, New York, focusing on a 500m buffer zone around streams. 

Materials and methods

The analysis uses elevation data, stream extraction, and OpenStreetMap building footprints to assess flood risk. The goal is to identify buildings within the flood-prone area, providing insights for urban planning and disaster preparedness.

Here's my first code chunk.

## Load and setip
install.packages("nhdplusTools")
library(nhdplusTools)
```{r}


library(sf)
library(terra)
library(elevatr)
library(dataRetrieval)
library(osmdata)
library(ggplot2)
library(dplyr)
library(leaflet)
library(htmlwidgets)
library(knitr)
library(tmap)
```
#Create directories
```{r}
dir.create("simple_flood_assessment", showWarnings = FALSE)
setwd("simple_flood_assessment")
dir.create("data", showWarnings = FALSE)
dir.create("outputs", showWarnings = FALSE)

#Define Buffalo Creek study area
bbox_coords <- c(xmin = -78.85, ymin = 42.80, xmax = -78.65, ymax = 42.92)
study_bbox <- st_bbox(bbox_coords, crs = 4326)
study_area <- st_as_sfc(study_bbox) |> st_sf()

#Download DEM
dem_raw <- get_elev_raster(locations = study_area, z = 13, src = "aws")
dem <- rast(dem_raw)
writeRaster(dem, "data/buffalo_dem.tif", overwrite = TRUE)

print(paste("DEM Resolution:", res(dem), "meters"))
print(paste("Elevation range:", round(minmax(dem)), "to", round(minmax(dem)), "meters"))
plot(dem)
```

## Stream Extraction (Centerlines Only)
```{r}
library(nhdplusTools)
library(sf)

# Define area of interest as sf polygon (not bbox)
aoi <- sf::st_as_sfc(sf::st_bbox(c(xmin = -79.8, ymin = 40.6, xmax = -79.5, ymax = 41.0), 
                                   crs = "EPSG:4326"))

# Download flowlines for the area
flowlines <- get_3dhp(AOI = aoi, type = "flowline")

# Filter for Buffalo Creek
buffalo_creek <- flowlines |>
  filter(grepl("Buffalo", gnisidlabel, ignore.case = TRUE))

# Visualize just the stream
plot(st_geometry(buffalo_creek), col = "blue", lwd = 2, main = "Buffalo Creek Stream Network")
```


```{r}
buffalo_creek_proj <- st_transform(buffalo_creek, crs = 32617) # UTM zone for your area
stream_buffer <- st_buffer(buffalo_creek_proj, dist = 500) # 500 meters

# Transform back to WGS84 for plotting or OSM intersection
stream_buffer_wgs84 <- st_transform(stream_buffer, crs = 4326)

# Plot buffer and stream
plot(st_geometry(stream_buffer_wgs84), col = rgb(1,0,0,0.2), main = "Buffalo Creek 500m Flood Buffer")
plot(st_geometry(buffalo_creek), col = "blue", lwd = 2, add = TRUE)


```
```{r}
# Define the study area polygon for OSM query
bbox <- st_bbox(stream_buffer_wgs84)

# Get buildings from OSM
buildings_osm <- opq(bbox = bbox) %>%
  add_osm_feature(key = "building") %>%
  osmdata_sf()

# Extract building polygons
buildings <- buildings_osm$osm_polygons

# Ensure same CRS for intersection
buildings <- st_transform(buildings, st_crs(stream_buffer_wgs84))
```


```{r}
# Spatial intersection
buildings_at_risk <- st_intersection(buildings, stream_buffer_wgs84)

# Check how many buildings are affected
cat("Number of buildings at risk:", nrow(buildings_at_risk), "\n")

```
```{r}
library(tmap)

tmap_mode("view") # interactive map

tm_shape(stream_buffer_wgs84) +
  tm_fill(col = "red", alpha = 0.2, title = "500m Flood Buffer") +
  tm_shape(buffalo_creek) +
  tm_lines(col = "blue", lwd = 2, title = "Buffalo Creek") +
  tm_shape(buildings) +
  tm_polygons(col = "grey", alpha = 0.5, title = "Buildings") +
  tm_shape(buildings_at_risk) +
  tm_polygons(col = "orange", alpha = 0.8, title = "Buildings at Risk")

```


